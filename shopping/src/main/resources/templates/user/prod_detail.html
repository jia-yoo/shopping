<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css" href="/css/styles.css">
</head>
<body>
<header>
	<nav>
		<a href="/"><img id="logo" style="width:50px; height:50px;" src="/img/logo.jpg"></a>
		<a href="/user/shop">shop</a>
		<div class="cart-wrap" onclick="location.href='/member/cart'">
			<div class="cart-image">
				<img style="width:50px; height:50px;" src="/img/shopping_cart.png">
			</div>
			<div  class="cart-text">
				<span>0</span>
			</div>
		</div>
		<th:block th:if="${session.id == null}">
			<a href="/member/mem_regForm">íšŒì›ê°€ì…í•˜ê¸°</a>
			<a href="/member/login">ë¡œê·¸ì¸í•˜ê¸°</a>
		</th:block>
		<th:block th:if="${session.id != null}">
			<span>[[${session.id}]] ë‹˜ ì–´ì„œì˜¤ì„¸ìš” ğŸ˜‰<span>
			<a href="/member/logout">ë¡œê·¸ì•„ì›ƒí•˜ê¸°</a>
			<a href="/member/myPage">ë§ˆì´í˜ì´ì§€</a>
		</th:block>
		<a href="/admin/admin_main">ê´€ë¦¬ìí˜ì´ì§€ë¡œê°€ê¸°</a>
	</nav>
</header>
<main>
	<h1>ìƒí’ˆìƒì„¸í˜ì´ì§€ ìœ ì €</h1>
	<table>
	    <tr>
		    <td colspan="2" th:if="${prod.fileName != null}">
				<img th:src="@{|/images/user/${prod.fileName}|}">
			</td>
			 <td colspan="2" th:if="${prod.fileName == null}">
				ì´ë¯¸ì§€ ì—†ìŒ
			</td>
		</tr>
		<tr>
			<th>ìƒí’ˆëª…</th>
			<td>[[${prod.pName}]]</td>
		</tr>
		<tr>
			<th>ìƒí’ˆ ê°€ê²©</th>
			<td>[[${prod.pPrice}]]</td>
		</tr>
		<tr>
			<th>í˜„ ì¬ê³ ìˆ˜ëŸ‰</th>
			<td>[[${prod.pQuan}]]</td>
		</tr>
		<tr>
			<th>ìƒíƒœ (íŒë§¤/í’ˆì ˆ)</th>
			<td th:if="${prod.status == 'onStock'}">íŒë§¤ì¤‘</td>
			<td th:if="${prod.status == 'soldout'}">ì¼ì‹œí’ˆì ˆ</td>
		</tr>
		<tr>
			<th>ìƒí’ˆ ìƒì„¸ ì„¤ëª…</th>
			<td>[[${prod.description}]]</td>
		</tr>
	</table>
	
	<span id="dec">â—€</span><span id="orderQuan">1</span><span id="inc">â–¶</span>
	<div class="orderContainer">
		<button id="addToCartBtn" onclick=''>ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸°</button>
		<button id="goToOrderBtn" onclick=''>ì£¼ë¬¸í•˜ê¸°</button>
	</div>
	<div class="review">
		<ul th:if="${review != null}" th:each="review : ${review}">
			<li></li>
		</ul>
	</div>
</main>
<script th:inline="javascript">

const decBtn = document.querySelector("#dec");
const incBtn = document.querySelector("#inc");
const orderQuanEl = document.querySelector("#orderQuan");
const addToCartBtn = document.querySelector("#addToCartBtn");
const goToOrderBtn = document.querySelector("#goToOrderBtn");
const orderContainer = document.querySelector(".orderContainer");
const pno = [[${prod.pno}]];
const status = [[${prod.status}]];
const cartQuanEl = document.querySelector("#cartQuan");

decBtn.addEventListener("click", function(e){
	let orderQuan = Number(orderQuanEl.innerText);
	orderQuan--;
	if(orderQuan > 0){
		orderQuanEl.innerHTML = orderQuan;
	}
})
incBtn.addEventListener("click", function(e){
	let orderQuan = Number(orderQuanEl.innerText);
	orderQuan++;
	if(orderQuan > 1){
		orderQuanEl.innerHTML = orderQuan;
	}
})
goToOrderBtn.addEventListener("click", function(){
	if(confirm("ì •ë§ë¡œ ì£¼ë¬¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
		let orderQuan = Number(orderQuanEl.innerText);
		 const xhttp = new XMLHttpRequest();
		  xhttp.onload = function() {
		    if(this.responseText == "true"){
		    	alert("ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
		    }else{
		    	alert("ì£¼ë¬¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”ğŸ˜¥");
		    }
		    }
		  xhttp.open("post", "/member/prod_order?pno="+pno+"&&sQuan="+orderQuan, true);
		  xhttp.send();
	}
})


//ìƒíƒœê°€ í’ˆì ˆì¼ê²½ìš° ì¥ë°”êµ¬ë‹ˆì— ë‹´ê¸° í˜¹ì€ ì£¼ë¬¸í•˜ê¸° ë²„íŠ¼ì´ ì•ˆë³´ì´ê²Œ ì²˜ë¦¬
if(status == "soldout"){
	goToOrderBtn.style.display="none";
	addToCartBtn.style.display="none";
	orderContainer.innerHTML="ì´ ìƒí’ˆì€ í˜„ì¬ ì¼ì‹œ í’ˆì ˆë¡œ, ì£¼ë¬¸ì´ ë¶ˆê°€í•©ë‹ˆë‹¤.";
}


addToCartBtn.addEventListener("click", function(){
	//ì¥ë°”êµ¬ë‹ˆì— ì•„ì´í…œë‹´ì•„ì£¼ê¸°
	let orderQuan = Number(orderQuanEl.innerText);
	 const xhttp = new XMLHttpRequest();
	  xhttp.onload = function() {
	    if(this.responseText == "true"){
	    	alert("ìƒí’ˆì´ ì„±ê³µì ìœ¼ë¡œ ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤.");
	    }else{
	    	alert("ìƒí’ˆì„ ì¥ë°”êµ¬ë‹ˆì— ë‹´ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”ğŸ˜¥");
	    }
	  }
	  xhttp.open("post", "/member/addToCart?pno="+pno+"&&sQuan="+orderQuan, true);
	  xhttp.send();
	
})

</script>
</body>
</html>