<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style>
img{
	width:100px;
	height:100px;
}
</style>
</head>
<body>
<header>
	<nav>
		<a href="/"><img id="logo" style="width:50px; height:50px;" src="/img/logo.jpg"></a>
		<a href="/user/shop">shop</a>
		<div class="cart-wrap" onclick="location.href='/member/cart'">
			<div class="cart-image">
				<img style="width:50px; height:50px;" src="/img/shopping_cart.png">
			</div>
			<div  class="cart-text">
				<span>0</span>
			</div>
		</div>
		<th:block th:if="${session.id == null}">
			<a href="/user/mem_regForm">íšŒì›ê°€ì…í•˜ê¸°</a>
			<a href="/user/login">ë¡œê·¸ì¸í•˜ê¸°</a>
		</th:block>
		<th:block th:if="${session.id != null}">
			<span>[[${session.id}]] ë‹˜ ì–´ì„œì˜¤ì„¸ìš” ğŸ˜‰<span>
			<a href="/member/logout">ë¡œê·¸ì•„ì›ƒí•˜ê¸°</a>
			<a href="/member/myPage">ë§ˆì´í˜ì´ì§€</a>
		</th:block>
		<a th:if="${session.id == 'admin'}" href="/admin/admin_main">ê´€ë¦¬ìí˜ì´ì§€ë¡œê°€ê¸°</a>
	</nav>
</header>
	<main>
	<table>
				<tr>
					<th>ìƒí’ˆ ì‚¬ì§„</th>
					<th>ìƒí’ˆëª…</th>
					<th>ìƒí’ˆ ìˆ˜ëŸ‰</th>
					<th>ìƒí’ˆ ê°€ê²©</th>
					<th>ì´ ê°€ê²©</th>
				</tr>
				<tr th:each="order : ${order}">
					<td><img th:src="@{|/images/user/${order.product.fileName}|}"></td>
					<td>[[${order.product.pName}]]</td>
					<td>
						<span class="orderQuan" th:text="${order.sQuan}">0</span>
					</td>
					<td>[[${order.product.pPrice}]]</td>
					<td class="itemTotalPrice" th:text="${#numbers.formatInteger(order.sQuan * order.product.pPrice, 0)}"></td>
				</tr>
				<tr>
					<th>TOTAL : </th>
					<td id="total"> </td>
				</tr>
			</table>
			<button onclick="cancelOrder()">ì£¼ë¬¸ ì·¨ì†Œ</button>
	</main>
<script th:inline="javascript">
 
 const itemTotalPrices = document.querySelectorAll(".itemTotalPrice");
 const orderNo = [[${orderNo}]];
 let sum=0;
 
 itemTotalPrices.forEach(prices=>{
	 let price = Number(prices.innerText);
	 sum += price;
	 document.querySelector("#total").innerHTML = sum + " ì›";
 })
 
 function cancelOrder(){
	 if(confirm("ì£¼ë¬¸ ì·¨ì†Œ í›„ ì² íšŒëŠ” ë¶ˆê°€ëŠ¥ í•©ë‹ˆë‹¤. ì •ë§ë¡œ í•´ë‹¹ ì£¼ë¬¸ì„ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
		 const xhttp = new XMLHttpRequest();
		  xhttp.onload = function() {
		    if(this.responseText == "true"){
		    	alert("í•´ë‹¹ ì£¼ë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ë¬¸ ë‚´ì—­ ë¦¬ìŠ¤íŠ¸ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.")
		    	location.href="/member/myPage";
		    };
		    }
		  xhttp.open("GET", "/member/cancel_order?orderNo="+orderNo, true);
		  xhttp.send();
	 }
 }
</script>
</body>
</html>